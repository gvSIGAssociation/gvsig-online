{% extends "filemanager_base.html" %}
{% load i18n staticfiles %}

{% block content %}

	{% include "filemanager_breadcrumbs.html" %}
	
<!-- 	<form id="fileupload" data-url="{% url 'filemanager:upload-file' %}"> -->
<!-- 	  <input type="hidden" name="path" value="{{path}}"> -->
<!-- 	  <input type="file" name="files[]" multiple> -->
<!-- 	</form> -->
	<div id="fileupload-component" class="fileupload-component"></div>
	<div style="margin-top: 30px;">
		<button id="upload-button" type="submit" class="btn btn-primary btn-block"><i class="fa fa-upload margin-r-5"></i> {% trans "Upload" %}</button>					
	</div>
	
{% endblock %}

{% block extra-scripts %}

	<script src="{% static "js/vendors/jQueryUI/jquery.ui.widget.js" %} "></script>
	<script src="{% static "js/jquery.iframe-transport.js" %} "></script>
	<script src="{% static "js/jquery.uploadfile.js" %} "></script>
	
	<script>
	$('#menu-manage-files').addClass("active");
	$(document).ready(function(){
		/*$('#fileupload').fileupload({
	      	dataType: 'json',
	      	done: function(e, data) {
	        	$.each(data.result.files, function (index, file) {
	        		$('<p/>').text(file.name).appendTo(document.body);
	      		});
	    	}
	  	});*/
	  	
	  	var fileupload = $('#fileupload-component');
		
	  	fileupload.uploadFile({
		   	url: "{% url 'filemanager:upload-file' %}",
		   	fileName: "files",
		   	multiple: true,
		   	autoSubmit:false,
		   	formData: {},
	    	onSuccess: function(files,data,xhr){
	    		var json = JSON.parse(data);
	    		$.overlayout();
	    		location.href = '/gvsigonline/filemanager/?path=' + json.path;
	    	},
	    	onError: function(files,status,errMsg){}
		});
	  	
	  	$('#upload-button').on('click', function () {		
	  		$("body").overlay();
			fileupload.appendExtraParams({'path': "{{path}}"});
			fileupload.startUpload();
		});
	});
	</script>
	
{% endblock %}
