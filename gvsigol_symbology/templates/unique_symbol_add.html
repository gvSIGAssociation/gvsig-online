{% extends "base_symbology.html" %}
{% load staticfiles %}
{% load i18n %}

{% block content %}	  	  
<div class="row">
	<div class="col-md-12">
		<div class="box box-primary">
		
			<div class="box-header with-border step-2">
				<h3 class="box-title">{% trans "Create new style" %}</h3>
				<div class="box-tools pull-right">
					<button id="refresh-preview" class="btn btn-box-tool refresh-preview"><i class="fa fa-refresh margin-r-5"></i> {% trans "Update preview" %}</button>
					<button id="metadata-legend" class="btn btn-box-tool metadata-legend"><i class="fa fa-cog margin-r-5"></i> {% trans "Metadata" %}</button>			
					<button id="default-legend" class="btn btn-box-tool default-legend"><i class="fa fa-star margin-r-5"></i> {% trans "Set default" %}</button>
					<button id="save-legend" class="btn btn-box-tool save-legend"><i class="fa fa-floppy-o margin-r-5"></i> {% trans "Save" %}</button>					
				</div>
			</div>

			<div class="box-body">
			
				<div class="row">
					<div class="col-md-12">
						<div id="map" class="preview-map"></div>
					</div>
				</div>
				
				<div class="row">
					<div class="col-md-4">
						<div class="box box-primary">
							<div class="box-header with-border">
								<h3 class="box-title">{% trans "Symbol elements" %}</h3>
							</div>
							<div class="box-body">
								<div class="table-responsive">
									<table id="table-unique-symbol" class="table no-margin">
										<thead>
											<tr>
												<th>{% trans "Name" %}</th>
												<th>{% trans "Preview" %}</th>
												<th></th>
											</tr>
										</thead>
										<tbody id="table-unique-symbol-body">
										</tbody>
									</table>
								</div>
							</div>

							<div class="box-footer clearfix">
								<a id="append-label-button" href="javascript:void(0)" class="btn btn-sm btn-default btn-flat pull-right margin-r-5"><i class="fa fa-tags margin-r-5"></i>{% trans "Append label" %}</a>
								<a id="append-symbol-button" href="javascript:void(0)" class="btn btn-sm btn-default btn-flat pull-right margin-r-5"><i class="fa fa-star-o margin-r-5"></i>{% trans "Append symbol" %}</a>
							</div>
						</div>
					</div>

					<div class="col-md-8">
						<div class="nav-tabs-custom">
				            <ul id="tab-menu" class="nav nav-tabs">				                        
				            </ul>
				            <div id="tab-content" class="tab-content">
				            </div>
          				</div>
          			</div>
				</div>
			</div>
		</div>
	</div>
</div>     	
{% endblock %}

{% block extra-scripts %}
<script>
	$('#menu-manage-symbology').addClass("active");
	$('#submenu-styles').addClass("active");
</script>
<script>
$(document).ready(function() {
	//Init DOM components
	var map = new ol.Map({
		layers: [
		    new ol.layer.Tile({
            	source: new ol.source.MapQuest({layer: 'osm'})
          	})
		],
		target: "map",
		view: new ol.View({
		    center:[0,0],
		    zoom: '2'
		})
	});
	
	$("#append-symbol-button").on('click', function(e){
		uniqueSymbol.appendSymbol();
	});
	
	$("#append-label-button").on('click', function(e){
		uniqueSymbol.appendLabel();
	});
	
	var layerId = "{{layer_id}}";
	var featureType = "{{featureType}}";
	var fields = {{fields|safe}};
	var alphanumericFields = {{alphanumeric_fields|safe}};
	var sldFilterValues = {{sldFilterValues|safe}};
	var fonts = {{ fonts|safe }};
	
	var uniqueSymbol = new UniqueSymbol(featureType, fields, alphanumericFields, sldFilterValues, fonts);
	
	$("#save-legend").on('click', function(e){
		uniqueSymbol.save(layerId);
	});

});
</script>
{% endblock %}