{% extends "base.html" %}
{% load staticfiles %}
{% load i18n %}

{% block content %}	
<div class="row">
	<div class="col-md-12">
		<div class="box">

			<div class="box-header with-border">
				<h3 class="box-title">{% trans "Update layer" %}</h3>
			</div>

			<form role="form" method="post" action="/gvsigonline/services/layer_update/{{layer_id}}/">
				{% csrf_token %}
				<div class="box-body">										
					{% if form.errors %}
					<div id="form-error" style="color:#ff0000;">
						<ul>
						{% for field in form %}
							{% if field.errors %}
								<li>{{field.label}}. {{ field.errors|striptags }}</li>
							{% endif %}	
						{% endfor %}
						</ul>
					</div>
					{% endif %}
							
					{% if message %}
					<div id="form-error" style="color:#ff0000;">
						<p>* {{ message }}</p>
					</div>
					{% endif %}
				
					<div class="row">
						<div class="col-md-12 form-group">
							<label for="workspace">{% trans "Workspace" %}</label>
							<input readonly="true" name="workspace" id="workspace" type="text" class="form-control" value="{{workspace.name}}">
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 form-group">
							<label for="datastore">{% trans "Data Store" %}</label>
							<input readonly="true" name="datastore" id="datastore" type="text" class="form-control" value="{{layer.datastore.name}}">
						</div>
					</div>

					<div class="row">
						<div class="col-md-12 form-group">
							<label for="name">{% trans "Resource name" %}</label>
							<input readonly="true" name="name" id="name" type="text" class="form-control" value="{{layer.name}}">
						</div>
					</div>
				
					<div class="row">
						<div class="col-md-12 form-group">
							<label for="title">{% trans "Title" %}</label>
							<input name="title" id="title" type="text" class="form-control" value="{{layer.title}}">
						</div>
					</div>
	
					<div class="row">
						<div class="col-md-12 form-group">
							<label class="active" for="id_layer_group">{% trans "Layer group" %}</label>
							{{ form.layer_group }}
						</div>
					</div>
					
					<div class="row">
						<div class="col-md-12 form-group">
							<span>{% trans "Layer properties in the viewer" %}.</span>
						</div>
						<div class="col-md-4 form-group">
							{% if layer.visible %}
							<input type="checkbox" name="visible"  id="visible" checked/>
							{% else %}
							<input type="checkbox" name="visible"  id="visible"/>
							{% endif %}
							<label for="visible">{% trans "Visible" %}</label>
						</div>
						<div class="col-md-4 form-group">
							{% if layer.cached %}
							<input type="checkbox" name="cached"  id="cached" checked/>
							{% else %}
							<input type="checkbox" name="cached"  id="cached"/>
							{% endif %}
							<label for="cached">{% trans "Cached" %}</label>
						</div>
						<div class="col-md-4 form-group">
							{% if layer.queryable %}
							<input type="checkbox" name="queryable"  id="queryable" checked/>
							{% else %}
							<input type="checkbox" name="queryable"  id="queryable"/>
							{% endif %}
							<label for="queryable">{% trans "Queryable" %}</label>
						</div>
					</div>
					<div class="row">
						<div class="col-md-4 form-group">
							{% if layer.single_image %}
							<input type="checkbox" name="single_image"  id="single_image" checked/>
							{% else %}
							<input type="checkbox" name="single_image"  id="single_image"/>
							{% endif %}
							<label for="visible">{% trans "Single image (No tiles)" %}</label>
						</div>
					</div>
				</div>
				
				<div class="box-footer">
					{% if layer.type == 'v_PostGIS' %}
					<button id="dash-submit-button" type="submit" class="btn btn-default">{% trans "Next" %}</button>
					{% else %}
                   	<button id="dash-submit-button" type="submit" class="btn btn-default"><i class="fa fa-floppy-o margin-r-5"></i> {% trans "Save" %}</button>
                	{% endif %}
                 </div>
                 
			</form>		
		</div>
	</div>
</div>
{% endblock %}

{% block extra-scripts %}
<script type="text/javascript">
	$(document).ready(function() {
		
		$('#select-style option[value="{{layer.style}}"]').attr('selected','selected');
		
		// translate default layer group
		var lgs = $("#id_layer_group");
		var lg_options = $("#id_layer_group option");
		for (var i=0; i<lg_options.length; i++) {
			text = $(lg_options[i]).text();
			if (text=="__default__") {
				$(lg_options[i]).html('{% trans "Default" %}');
			}
			if (lgs.val()=="") {
				lgs.val(1);
			}
		}
		
		$('#dash-submit-button').click( function() {
			$("body").overlay();
		});
	});
</script>
{% endblock %}